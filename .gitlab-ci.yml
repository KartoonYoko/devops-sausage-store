stages:
  # - build
  - notify

# build-backend-code-job:
#   stage: build  
#   only:
#     changes:
#     - backend/*
#   script:
#     - cd backend
#     - mvn package
#   artifacts:
#     paths:
#       - backend/target/sausage-store-0.0.1-SNAPSHOT.jar

# build-frontend-code-job:
#   stage: build  
#   only:
#     changes:
#     - frontend/*
#   script:        
#     - cd frontend
#     - npm install
#     - npm run build
#   artifacts:
#     paths:
#       - frontend/dist/frontend

telegram-notification-backend:
  stage: notify
  only:
    variables:
    - $CI_COMMIT_MESSAGE =~ /send notification/
    changes:
    - backend/*
  script:
    - curl -X POST -H 'Content-type:application/json' --data '{"chat_id":"-1001657575944", "text":"backend https://gitlab.praktikum-services.ru/api/v4/projects/2757/jobs/artifacts/release-0.0.1/download?job=build-backend-code-job"}' https://api.telegram.org/bot5933756043:AAE8JLL5KIzgrNBeTP5e-1bkbJy4YRoeGjs/sendMessage
  # needs:
  #   - build-backend-code-job

telegram-notification-frontend:
  stage: notify
  only:
    variables:
    - $CI_COMMIT_MESSAGE =~ /send notification/
    changes:
    - frontend/*
  script:
    - curl -X POST -H 'Content-type:application/json' --data '{"chat_id":"-1001657575944", "text":"frontend https://gitlab.praktikum-services.ru/api/v4/projects/2757/jobs/artifacts/release-0.0.1/download?job=build-frontend-code-job"}' https://api.telegram.org/bot5933756043:AAE8JLL5KIzgrNBeTP5e-1bkbJy4YRoeGjs/sendMessage
  # needs:
  #   - build-frontend-code-job